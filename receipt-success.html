<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DHS 1975 Reunion Registration Receipt</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 30px;
    }
    .receipt {
      background: #fff;
      padding: 25px;
      max-width: 800px;
      margin: auto;
      border: 1px solid #ccc;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .receipt-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }
    h2 {
      margin: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }
    th:first-child, td:first-child {
      text-align: left;
    }
    .totals {
      margin-top: 30px;
      font-weight: bold;
      line-height: 1.6;
    }
    .actions {
      text-align: center;
      margin-top: 30px;
    }
    .actions button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 15px;
      cursor: pointer;
    }
    .note {
      margin-top: 20px;
      font-size: 14px;
      color: #555;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="receipt" id="receipt">
  <div class="receipt-header">
    <h2>DHS Class of 1975 Reunion Registration Receipt</h2>
    <div id="todayDate" style="font-size: 14px; color: #555;"></div>
  </div>

  <hr>

  <div><strong>Classmate Name:</strong> <span id="classmateName"></span></div>
  <div><strong>Guest Name:</strong> <span id="guestName"></span></div>
  <div><strong>Registration ID:</strong> <span id="regId"></span></div>
  <div><strong>Email:</strong> <span id="emailAddress"></span></div>

  <h3 style="margin-top: 30px;">Event Attendance</h3>
  <table>
    <thead>
      <tr style="background-color: #eee;">
        <th>Event / Time</th>
        <th style="width: 120px;">Classmate</th>
        <th style="width: 120px;">Guest</th>
      </tr>
    </thead>
    <tbody id="eventRows">
      <!-- JavaScript will populate this -->
    </tbody>
  </table>

  <div class="totals">
    <p>Classmate Registration: $<span id="classmateFee"></span><br>
    <span id="guestFeeRow" style="display:none;">Guest Registration: $<span id="guestFee"></span><br></span>
    Legacy Fund Donation: $<span id="legacy"></span><br>
    <strong>Total Paid:</strong> $<span id="total"></span></p>
  </div>

  <p class="note">Thank you for registering! If you have any questions, reply to this email.</p>
</div>

<div class="actions">
  <button onclick="downloadPDF()">Download PDF</button>
  <button onclick="window.print()">Print</button>
  <button onclick="sendEmail()">Email to <span id="emailButtonText"></span></button>
</div>

<script>
  function getParam(key) {
    const url = new URL(window.location.href);
    return decodeURIComponent(url.searchParams.get(key) || "").toLowerCase();
  }

  function addCheck(value) {
    return value === "yes" || value === "✓" ? "✓" : "";
  }

  // Fill basic data
  const classmate = getParam("name");
  const guest = getParam("guest");
  const regId = getParam("regid");
  const email = getParam("email");
  const legacy = parseFloat(getParam("legacy") || "0").toFixed(2);
  const baseFee = parseFloat(getParam("fee") || "0");

  // Set receipt fields
  document.getElementById("classmateName").textContent = classmate;
  document.getElementById("guestName").textContent = guest;
  document.getElementById("regId").textContent = regId;
  document.getElementById("emailAddress").textContent = email;
  document.getElementById("emailButtonText").textContent = email;
  document.getElementById("legacy").textContent = legacy;
  document.getElementById("todayDate").textContent = new Date().toLocaleDateString();

  // Calculate fees
  const guestFee = guest ? baseFee : 0;
  document.getElementById("classmateFee").textContent = baseFee.toFixed(2);
  if (guestFee > 0) {
    document.getElementById("guestFee").textContent = guestFee.toFixed(2);
    document.getElementById("guestFeeRow").style.display = "inline";
  }

  const total = baseFee + guestFee + parseFloat(legacy);
  document.getElementById("total").textContent = total.toFixed(2);

  // Populate event table
  const events = [
    { label: "Friday Tour - 10:00 AM", c: "friday_tour_classmate", g: "friday_tour_guest" },
    { label: "Tailgate Party - 5:00 PM", c: "tailgate_classmate", g: "tailgate_guest" },
    { label: "Football Game - 7:00 PM", c: "football_game_classmate", g: "football_game_guest" },
    { label: "Saturday Tour - 9:00 AM", c: "saturday_tour_classmate", g: "saturday_tour_guest" },
    { label: "Saturday Breakfast - 8:00 AM", c: "saturday_breakfast_classmate", g: "saturday_breakfast_guest" },
    { label: "Saturday Golf - 12:00 PM", c: "saturday_golf_classmate", g: "saturday_golf_guest" },
    { label: "Reunion Dinner - 6:00 PM", c: "reunion_dinner_classmate", g: "reunion_dinner_guest" }
  ];

  const tbody = document.getElementById("eventRows");
  events.forEach(evt => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${evt.label}</td><td>${addCheck(getParam(evt.c))}</td><td>${addCheck(getParam(evt.g))}</td>`;
    tbody.appendChild(tr);
  });

  function downloadPDF() {
    html2pdf().from(document.getElementById("receipt")).save("DHS-Reunion-Receipt.pdf");
  }

  function sendEmail() {
    const subject = "DHS Reunion Registration Receipt";
    const body = encodeURIComponent(document.getElementById("receipt").innerText);
    window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
  }
</script>

</body>
</html>



